name: Release

on:
  push:
    branches:
      - main
      - prerelease

    permissions:
      contents: write
      issues: write
      pull-requests: write

    jobs:
      release:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout code
            uses: actions/checkout@v3

          - name: Set up Node.js
            uses: actions/setup-node@v4
            with:
              node-version: "lts/*"

          - run: npm ci
          - run: npm run build
          - run: run audit signatures

          - name: Release
            env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
            run: npx semantic-release
